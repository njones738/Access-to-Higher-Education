---
title: "work"
author: "Nathaniel Jones"
output: word_document
---

```{r setup, include=F,echo=F}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=8)
#install.packages("officedown")
#install.packages("officer")
#install.packages("magrittr")
#install.packages("tidyverse") 
#install.packages("ggpubr") 
#install.packages("gplots") 
#install.packages("multcompView") 

library(ggpubr)
library(gplots)
library(multcompView)
library(tidyverse)
library(magrittr)   # piping related. %<>% is "<-" + "and then". both assigns and pipes.
library(officedown) # to change the text colors
library(officer)    # used with officedown
library(perm)
library(jmuOutlier) # source of perm test for median and trimmed means.
library(plyr)       # ddply
ft <- fp_text(color = 'mediumorchid4', bold = TRUE) # change the color of text easily
inline_hook <- function(x) {                # used in making the numbers print in decimal form instead of scientific notation
  if (is.numeric(x)) {
    format(x, digits = 9)
  } else x 
}
knitr::knit_hooks$set(inline = inline_hook) # this makes the numbers not print in scientific notation during inline code.
wrapper <- function(x) {
  round(x,4)
}
```

```{r read in dataset and set the mood, echo=F,echo=F}
# Import the 2018 College Scorecard data and tidy it up.
CollegeSC18 <- read.csv("MERGED2018_19_PP.csv", stringsAsFactors = TRUE, na.strings = c("PrivacySuppressed","NULL","NaN","NA"))
CollegeSC18 <- tibble(CollegeSC18)
#CollegeSC18 %>% head(10)
personal_Palette <- c("#999999","#bae600", "#E6c500", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#CC79A7","mediumpurple","mediumpurple4",
                     "cornflowerblue","magenta3","royalblue4","orchid4","orchid3","orchid1","plum4","turquoise1","turquoise","turquoise4",
                     "violet","plum3","plum1","aquamarine","aquamarine3","aquamarine4","cyan","cyan4","cyan3")
cbPalette <- c("#999999", "#56B4E9", "#009E73", "#0072B2", "#CC79A7")
CollegeSC18 %<>% mutate("PCTPELL_CAT" = ifelse(is.na(PCTPELL)!=T,               # Check if missing. IF not True, THEN continue, ELSE go to **
                                               ifelse(PCTPELL <= .5,0,          # Check Condition One, return 0 if true, 
                                                      1),                       # ELSE return 1
                                               NA))
CollegeSC18$PCTPELL_CAT <- as.factor(CollegeSC18$PCTPELL_CAT)

iters <- 10000
scalr <- 1
```

```{r Subsetting GRAD rate}
CollegeSC18 %<>% mutate("GRAD_CAT" = ifelse(is.na(OMAWDP8_ALL),NA,
                                            ifelse(OMAWDP8_ALL<.25,0,
                                                   ifelse(OMAWDP8_ALL>.5,2,1))))
CollegeSC18$GRAD_CAT <- as.factor(CollegeSC18$GRAD_CAT)
CollegeSC18 %>% select(GRAD_CAT) %>% summary()
```

```{r functions,include=F}
RMD.test <- function(samp1,samp2,direction=c('two.sided','less','greater')[1],nsamp=10000,nprt=0){
  devs1 <- samp1-median(samp1)
  devs2 <- samp2-median(samp2)
  devs <- c(devs1,devs2)   #concatenates both data sets into one vector
  devs
  
  
  
  RMD <- mean(abs(devs1))/mean(abs(devs2))  #sample RMD
  if (direction[1]=='two.sided'){
    RMD <- max(1/RMD, RMD) #compensates when the smallest mean absolute deviation is on top to make sure that the largest mean absolute deviation is on top for the two.sided test
  }
  RMDperms <- rep(NA,nsamp) #sets up an empty vector of missing values to be filled for the 10,000 permutations

  
  for (i in 1:nsamp){
    tempdevs <- devs[sample(length(devs),length(devs),replace=FALSE)] # inside the square brackets is a sampling command that shuffles the indices 1 to the total number in both samples for the concatenated vector "devs"

    RMDperms[i] <- mean(abs(tempdevs[1:length(devs1)]))/mean(abs(tempdevs[-(1:length(devs1))]))
    if (direction[1]=='two.sided') RMDperms[i] <- max(1/RMDperms[i], RMDperms[i])
  }
  if (direction[1]=='greater') pVal <- mean(RMDperms>=RMD)
  if (direction[1]=='less') pVal <- mean(RMDperms<=RMD)
  if (direction[1]=='two.sided') pVal <- mean(RMDperms>=RMD)
  if (nprt==0) {
  return(c(print(paste("The mean absolute deviation for the data in sample 1 is:", round(mean(abs(devs1)),2) )),
           print(paste("The mean absolute deviation for the data in sample 2 is:", round(mean(abs(devs2)),2) )),
           print(paste("Test statistic:",round(RMD,4))),
           print(paste("Approximate p-value for ",direction[1],":  ",pVal,sep=""))))
  } else {
    return()
  }
}
```

```{r}
######################################################################################################################################################################
##### VARIABLE: OMAWDP8_ALL :: Graduation rate #######################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(OMAWDP8_ALL)==F) %>% select(PCTPELL,PCTPELL_CAT,OMAWDP8_ALL,INSTNM)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(OMAWDP8_ALL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

Quant_var <- CSC18$OMAWDP8_ALL    

G0 <- Zero_data$OMAWDP8_ALL
G1 <- One_data$OMAWDP8_ALL

         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)
ttst

         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)
wilcox_test

         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))
perm_Mean
observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
perm_mean_hist
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
p_value_mean

         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
p_value
```

```{r}
boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of the percent of students who graduated with an award within 8 years stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="OMAWDP8_ALL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(((boxplot.stats(G0)$stats)*100),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(((boxplot.stats(G1)$stats)*100),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for GRAD_RATE: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for GRAD_RATE: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")

ggplot(CSC18, aes(x=OMAWDP8_ALL,fill=PCTPELL_CAT)) + geom_histogram(color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + #scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of all student receiving an award within 8 years of entry.(OMAWDP8_ALL)") +
       labs(title= "Figure 1: Histogram of the Percentage of all student receiving an award within 8 years of entry stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) + theme_bw() +
       stat_bin(aes(y=..count..,label=..count..),binwidth=.07, geom="text",vjust=-.5) # find relative to the sum of each group


plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean + observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")

plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median + observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")
```


```{r}
######################################################################################################################################################################
##### VARIABLE: OMENRYP_ALL :: Still enrolled rate ###################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(OMENRYP_ALL)==F) %>% select(PCTPELL,PCTPELL_CAT,OMENRYP_ALL,INSTNM)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(OMENRYP_ALL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=OMENRYP_ALL,fill=PCTPELL_CAT)) + 
  geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.035) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of all students that did not receive an award and are still enrolled at this institution 8 years after entry. (OMENRYP_ALL)") +
       labs(title= "Figure 1: Histogram of the Percentage of all students that did not receive an award and are still enrolled at this institution 8 years after entry stratified by the categories of PCTPELL_CAT. (n = 5065)") + scale_x_continuous(breaks=seq(0,1,.035)) + scale_y_continuous(labels=scales::percent) +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.035, geom="text",vjust=-.5)+
       theme(axis.text.x = element_text(angle = 45))

Quant_var <- CSC18$OMENRYP_ALL

G0 <- Zero_data$OMENRYP_ALL
G1 <- One_data$OMENRYP_ALL

#CSC18 %>% filter(OMENRYP_ALL >= .5)

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of percent of students still enrolled without a degree within 8 years stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="OMENRYP_ALL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
#text(y = boxplot.stats(G0)$stats, 
#     labels = paste(((boxplot.stats(G0)$stats)*100),"%",sep=" "), 
#     x = 1.34, 
#     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%","Blackhawk Technical College",sep=" "), 
     x =  1.44, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
#text(y = boxplot.stats(G1)$stats, 
#     labels = paste(((boxplot.stats(G1)$stats)*100),"%",sep=" "), 
#     x = 2.33, 
#     col = "black",
#     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste("Instituto Tecnologico de Puerto Rico-Recinto de San Juan",(round(max(G1),3)*100),"%",sep=" "), 
     x =  1.26, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STILL_ENRL: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STILL_ENRL: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)
ttst

         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)
wilcox_test

         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))
perm_Mean
observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
p_value_mean


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
p_value



plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.03),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.03,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")

plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.02))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.01,2400*scalr,col=alpha("red",0))
text(.005, 1500*scalr, "Difference in medians")
text(.005, 1433*scalr, "greater than or equal")
text(.005, 1369*scalr, "to the observed difference")


```

```{r}
######################################################################################################################################################################
##### VARIABLE: OMENRAP_ALL :: Transfer rate #########################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(OMENRAP_ALL)==F) %>% select(PCTPELL,PCTPELL_CAT,OMENRAP_ALL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(OMENRAP_ALL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=OMENRAP_ALL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of all students that did not receive an award and enrolled at another institution after leaving this institution within 8 years of entry.(OMENRAP_ALL)") +
       labs(title= "Figure 1: Histogram of the Percentage of all students that did not receive an award and enrolled at another institution after leaving this institution within 8 years of entry stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$OMENRAP_ALL

G0 <- Zero_data$OMENRAP_ALL
G1 <- One_data$OMENRAP_ALL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of the percent of students who transferred within 8 years stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="OMENRAP_ALL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(((boxplot.stats(G0)$stats)*100),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(((boxplot.stats(G1)$stats)*100),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for TRAN_RATE: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for TRAN_RATE: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")
         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r}
######################################################################################################################################################################
##### VARIABLE: OMENRUP_ALL :: Status Unkown rate ####################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(OMENRUP_ALL)==F) %>% select(PCTPELL,PCTPELL_CAT,OMENRUP_ALL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(OMENRUP_ALL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=OMENRUP_ALL,fill=PCTPELL_CAT)) + 
  geom_histogram(aes(y=stat(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + #scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
  facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of all students that did not receive an award and whose enrollment status is unknown after leaving this institution within 8 years of entry.(OMENRUP_ALL)") +
       labs(title= "Figure 1: Histogram of the Percentage of all students that did not receive an award and whose enrollment status is unknown after leaving this institution within 8 years of entry stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count..,label=..count..),binwidth=.07, geom="text",vjust=-.5)

#ggplot(CSC18,aes(x=OMENRUP_ALL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count),fill=PCTPELL_CAT),color="black",binwidth=.07)

Quant_var <- CSC18$OMENRUP_ALL

G0 <- Zero_data$OMENRUP_ALL
G1 <- One_data$OMENRUP_ALL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of percent of students without a degree and an unkown status after 8 years stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="OMENRUP_ALL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(((boxplot.stats(G0)$stats)*100),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(((boxplot.stats(G1)$stats)*100),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")

CollegeSC18 %>% filter(INSTNM == "Harvard University") %>% select(INSTNM,PCTPELL,PCTPELL_CAT,OMENRUP_ALL,GRAD_CAT,OMAWDP8_ALL)
CollegeSC18 %>% filter(INSTNM == "Stanford University") %>% select(INSTNM,PCTPELL,PCTPELL_CAT,OMENRUP_ALL,GRAD_CAT,OMAWDP8_ALL)
CollegeSC18 %>% filter(INSTNM == "University of Chicago") %>% select(INSTNM,PCTPELL,PCTPELL_CAT,OMENRUP_ALL,GRAD_CAT,OMAWDP8_ALL)
CollegeSC18 %>% filter(INSTNM == "Kennesaw State University") %>% select(INSTNM,PCTPELL,PCTPELL_CAT,OMENRUP_ALL,GRAD_CAT,OMAWDP8_ALL)
```



```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_DFLT :: Default rate ####################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_DFLT)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_DFLT)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_DFLT))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_DFLT,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  scale_x_continuous(breaks=seq(0,1,.034)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_DFLT.(BBRR2_FED_UG_DFLT)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(count),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_DFLT

G0 <- Zero_data$BBRR2_FED_UG_DFLT
G1 <- One_data$BBRR2_FED_UG_DFLT

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_DFLT",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_DLNQ :: Delinquency rate ################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_DLNQ)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_DLNQ)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_DLNQ))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_DLNQ,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_DLNQ.(BBRR2_FED_UG_DLNQ)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_DLNQ

G0 <- Zero_data$BBRR2_FED_UG_DLNQ
G1 <- One_data$BBRR2_FED_UG_DLNQ

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_DLNQ",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.06),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.06,1500*scalr,col=alpha("red",0))
text(.036, 975*scalr, "Difference in mean")
text(.036, 913*scalr, "greater than or equal")
text(.036, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.06))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.06,2400*scalr,col=alpha("red",0))
text(.039, 1500*scalr, "Difference in medians")
text(.039, 1433*scalr, "greater than or equal")
text(.039, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_FBR :: Forbearance rate #################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_FBR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_FBR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_FBR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_FBR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_FBR.(BBRR2_FED_UG_FBR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_FBR

G0 <- Zero_data$BBRR2_FED_UG_FBR
G1 <- One_data$BBRR2_FED_UG_FBR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_FBR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_DFR :: Deferment rate ###################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_DFR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_DFR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_DFR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_DFR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_DFR.(BBRR2_FED_UG_DFR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_DFR

G0 <- Zero_data$BBRR2_FED_UG_DFR
G1 <- One_data$BBRR2_FED_UG_DFR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_DFR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_NOPROG :: Not making progress rate ######################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_NOPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_NOPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_NOPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_NOPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_NOPROG.(BBRR2_FED_UG_NOPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_NOPROG

G0 <- Zero_data$BBRR2_FED_UG_NOPROG
G1 <- One_data$BBRR2_FED_UG_NOPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_NOPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_MAKEPROG :: Making progress rate ########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_MAKEPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_MAKEPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_MAKEPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_MAKEPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_MAKEPROG.(BBRR2_FED_UG_MAKEPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_MAKEPROG

G0 <- Zero_data$BBRR2_FED_UG_MAKEPROG
G1 <- One_data$BBRR2_FED_UG_MAKEPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_MAKEPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_PAIDINFULL :: Paid in full rate #########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_PAIDINFULL)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_PAIDINFULL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_PAIDINFULL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_PAIDINFULL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.05) +
  scale_x_continuous(breaks=seq(0,1,.05)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_PAIDINFULL.(BBRR2_FED_UG_PAIDINFULL)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.05, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_PAIDINFULL

G0 <- Zero_data$BBRR2_FED_UG_PAIDINFULL
G1 <- One_data$BBRR2_FED_UG_PAIDINFULL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_PAIDINFULL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_DISCHARGE :: All loans discharged rate ##################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UG_DISCHARGE)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UG_DISCHARGE)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UG_DISCHARGE))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UG_DISCHARGE,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  geom_histogram(aes(y=stat(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +scale_x_continuous(breaks=seq(0,1,.07)) + #scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_DISCHARGE.(BBRR2_FED_UG_DISCHARGE)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=..count..),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UG_DISCHARGE

G0 <- Zero_data$BBRR2_FED_UG_DISCHARGE
G1 <- One_data$BBRR2_FED_UG_DISCHARGE

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UG_DISCHARGE",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")
```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_DFLT :: Default rate ####################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_DFLT)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_DFLT)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_DFLT))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_DFLT,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  scale_x_continuous(breaks=seq(0,1,.034)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_DFLT.(BBRR2_FED_UGCOMP_DFLT)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(count),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_DFLT

G0 <- Zero_data$BBRR2_FED_UGCOMP_DFLT
G1 <- One_data$BBRR2_FED_UGCOMP_DFLT

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_DFLT",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_DLNQ :: Delinquency rate ################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_DLNQ)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_DLNQ)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_DLNQ))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_DLNQ,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_DLNQ.(BBRR2_FED_UGCOMP_DLNQ)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_DLNQ

G0 <- Zero_data$BBRR2_FED_UGCOMP_DLNQ
G1 <- One_data$BBRR2_FED_UGCOMP_DLNQ

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_DLNQ",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_FBR :: Forbearance rate #################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_FBR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_FBR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_FBR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_FBR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_FBR.(BBRR2_FED_UGCOMP_FBR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_FBR

G0 <- Zero_data$BBRR2_FED_UGCOMP_FBR
G1 <- One_data$BBRR2_FED_UGCOMP_FBR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_FBR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_DFR :: Deferment rate ###################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_DFR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_DFR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_DFR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_DFR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_DFR.(BBRR2_FED_UGCOMP_DFR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_DFR

G0 <- Zero_data$BBRR2_FED_UGCOMP_DFR
G1 <- One_data$BBRR2_FED_UGCOMP_DFR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_DFR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_NOPROG :: Not making progress rate ######################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_NOPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_NOPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_NOPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_NOPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_NOPROG.(BBRR2_FED_UGCOMP_NOPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_NOPROG

G0 <- Zero_data$BBRR2_FED_UGCOMP_NOPROG
G1 <- One_data$BBRR2_FED_UGCOMP_NOPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_NOPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_MAKEPROG :: Making progress rate ########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_MAKEPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_MAKEPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_MAKEPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_MAKEPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_MAKEPROG.(BBRR2_FED_UGCOMP_MAKEPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_MAKEPROG

G0 <- Zero_data$BBRR2_FED_UGCOMP_MAKEPROG
G1 <- One_data$BBRR2_FED_UGCOMP_MAKEPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_MAKEPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_PAIDINFULL :: Paid in full rate #########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_PAIDINFULL)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_PAIDINFULL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_PAIDINFULL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_PAIDINFULL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.05) +
  scale_x_continuous(breaks=seq(0,1,.05)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_PAIDINFULL.(BBRR2_FED_UGCOMP_PAIDINFULL)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.05, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_PAIDINFULL

G0 <- Zero_data$BBRR2_FED_UGCOMP_PAIDINFULL
G1 <- One_data$BBRR2_FED_UGCOMP_PAIDINFULL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_PAIDINFULL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGCOMP_DISCHARGE :: All loans discharged rate ##################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGCOMP_DISCHARGE)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGCOMP_DISCHARGE)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGCOMP_DISCHARGE))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGCOMP_DISCHARGE,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGCOMP_DISCHARGE.(BBRR2_FED_UGCOMP_DISCHARGE)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGCOMP_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGCOMP_DISCHARGE

G0 <- Zero_data$BBRR2_FED_UGCOMP_DISCHARGE
G1 <- One_data$BBRR2_FED_UGCOMP_DISCHARGE

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGCOMP_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGCOMP_DISCHARGE",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")
```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_DFLT :: Default rate ####################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_DFLT)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_DFLT)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_DFLT))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_DFLT,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  scale_x_continuous(breaks=seq(0,1,.034)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_DFLT.(BBRR2_FED_UGNOCOMP_DFLT)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(count),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_DFLT

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_DFLT
G1 <- One_data$BBRR2_FED_UGNOCOMP_DFLT

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_DFLT",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_DLNQ :: Delinquency rate ################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_DLNQ)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_DLNQ)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_DLNQ))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_DLNQ,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_DLNQ.(BBRR2_FED_UGNOCOMP_DLNQ)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_DLNQ

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_DLNQ
G1 <- One_data$BBRR2_FED_UGNOCOMP_DLNQ

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_DLNQ",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_FBR :: Forbearance rate #################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_FBR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_FBR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_FBR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_FBR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_FBR.(BBRR2_FED_UGNOCOMP_FBR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_FBR

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_FBR
G1 <- One_data$BBRR2_FED_UGNOCOMP_FBR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_FBR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_DFR :: Deferment rate ###################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_DFR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_DFR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_DFR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_DFR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_DFR.(BBRR2_FED_UGNOCOMP_DFR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_DFR

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_DFR
G1 <- One_data$BBRR2_FED_UGNOCOMP_DFR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_DFR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_NOPROG :: Not making progress rate ######################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_NOPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_NOPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_NOPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_NOPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_NOPROG.(BBRR2_FED_UGNOCOMP_NOPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_NOPROG

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_NOPROG
G1 <- One_data$BBRR2_FED_UGNOCOMP_NOPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_NOPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_MAKEPROG :: Making progress rate ########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_MAKEPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_MAKEPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_MAKEPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_MAKEPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_MAKEPROG.(BBRR2_FED_UGNOCOMP_MAKEPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_MAKEPROG

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_MAKEPROG
G1 <- One_data$BBRR2_FED_UGNOCOMP_MAKEPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_MAKEPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_PAIDINFULL :: Paid in full rate #########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_PAIDINFULL)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_PAIDINFULL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_PAIDINFULL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_PAIDINFULL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.05) +
  scale_x_continuous(breaks=seq(0,1,.05)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_PAIDINFULL.(BBRR2_FED_UGNOCOMP_PAIDINFULL)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.05, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_PAIDINFULL

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_PAIDINFULL
G1 <- One_data$BBRR2_FED_UGNOCOMP_PAIDINFULL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_PAIDINFULL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGNOCOMP_DISCHARGE :: All loans discharged rate ##################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGNOCOMP_DISCHARGE)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGNOCOMP_DISCHARGE)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGNOCOMP_DISCHARGE))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGNOCOMP_DISCHARGE,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGNOCOMP_DISCHARGE.(BBRR2_FED_UGNOCOMP_DISCHARGE)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGNOCOMP_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGNOCOMP_DISCHARGE

G0 <- Zero_data$BBRR2_FED_UGNOCOMP_DISCHARGE
G1 <- One_data$BBRR2_FED_UGNOCOMP_DISCHARGE

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGNOCOMP_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGNOCOMP_DISCHARGE",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")
```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_DFLT :: Default rate ####################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_DFLT)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_DFLT)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_DFLT))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_DFLT,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.034) +
  scale_x_continuous(breaks=seq(0,1,.034)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_DFLT.(BBRR2_FED_UGUNK_DFLT)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(count),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.034, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_DFLT

G0 <- Zero_data$BBRR2_FED_UGUNK_DFLT
G1 <- One_data$BBRR2_FED_UGUNK_DFLT

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_DFLT stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_DFLT",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_DLNQ :: Delinquency rate ################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_DLNQ)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_DLNQ)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_DLNQ))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_DLNQ,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_DLNQ.(BBRR2_FED_UGUNK_DLNQ)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_DLNQ

G0 <- Zero_data$BBRR2_FED_UGUNK_DLNQ
G1 <- One_data$BBRR2_FED_UGUNK_DLNQ

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_DLNQ stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_DLNQ",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_FBR :: Forbearance rate #################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_FBR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_FBR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_FBR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_FBR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_FBR.(BBRR2_FED_UGUNK_FBR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_FBR

G0 <- Zero_data$BBRR2_FED_UGUNK_FBR
G1 <- One_data$BBRR2_FED_UGUNK_FBR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_FBR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_FBR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_DFR :: Deferment rate ###################################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_DFR)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_DFR)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_DFR))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_DFR,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_DFR.(BBRR2_FED_UGUNK_DFR)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_DFR

G0 <- Zero_data$BBRR2_FED_UGUNK_DFR
G1 <- One_data$BBRR2_FED_UGUNK_DFR

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_DFR stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_DFR",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_NOPROG :: Not making progress rate ######################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_NOPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_NOPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_NOPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_NOPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_NOPROG.(BBRR2_FED_UGUNK_NOPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_NOPROG

G0 <- Zero_data$BBRR2_FED_UGUNK_NOPROG
G1 <- One_data$BBRR2_FED_UGUNK_NOPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_NOPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_NOPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
text(y = round(min(G0),3), 
     labels = paste((round(min(G0),3)*100),"%",sep=" "),
     x = 1.34, 
     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_MAKEPROG :: Making progress rate ########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_MAKEPROG)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_MAKEPROG)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_MAKEPROG))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_MAKEPROG,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.07) +
  scale_x_continuous(breaks=seq(0,1,.07)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_MAKEPROG.(BBRR2_FED_UGUNK_MAKEPROG)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.07, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_MAKEPROG

G0 <- Zero_data$BBRR2_FED_UGUNK_MAKEPROG
G1 <- One_data$BBRR2_FED_UGUNK_MAKEPROG

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_MAKEPROG stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_MAKEPROG",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
text(y = round(min(G1),3), 
     labels = paste((round(min(G1),3)*100),"%",sep=" "),
     x = 2.33, 
     col = "black", 
     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.3),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.3,1500*scalr,col=alpha("red",0))
text(.26, 975*scalr, "Difference in mean")
text(.26, 913*scalr, "greater than or equal")
text(.26, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.35))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",observed_test_stat_median,sep=""))
rect(observed_test_stat_median,0,.35,2400*scalr,col=alpha("red",0))
text(.29, 1500*scalr, "Difference in medians")
text(.29, 1433*scalr, "greater than or equal")
text(.29, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_PAIDINFULL :: Paid in full rate #########################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_PAIDINFULL)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_PAIDINFULL)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

mu <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.mean=mean(BBRR2_FED_UGUNK_PAIDINFULL))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_PAIDINFULL,fill=PCTPELL_CAT)) + geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.05) +
  scale_x_continuous(breaks=seq(0,1,.05)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_PAIDINFULL.(BBRR2_FED_UGUNK_PAIDINFULL)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=mu, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count../sum(..count..),label=paste(round(..count../sum(..count..),4)*100,"%",sep=" ")),binwidth=.05, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_PAIDINFULL

G0 <- Zero_data$BBRR2_FED_UGUNK_PAIDINFULL
G1 <- One_data$BBRR2_FED_UGUNK_PAIDINFULL

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_PAIDINFULL stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_PAIDINFULL",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)


         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))

observed_test_stat_mean <- abs(mean(G1)-mean(G0))

diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.009),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.004,1500*scalr,col=alpha("red",0))
text(.0033, 975*scalr, "Difference in mean")
text(.0033, 913*scalr, "greater than or equal")
text(.0033, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.004))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",wrapper(observed_test_stat_median),sep=""))
rect(observed_test_stat_median,0,.004,2400*scalr,col=alpha("red",0))
text(.004, 1500*scalr, "Difference in medians")
text(.004, 1433*scalr, "greater than or equal")
text(.004, 1369*scalr, "to the observed difference")


```

```{r ,echo=F}
######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UGUNK_DISCHARGE :: All loans discharged rate ##################################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(PCTPELL)==F,is.na(BBRR2_FED_UGUNK_DISCHARGE)==F) %>% select(PCTPELL,PCTPELL_CAT,BBRR2_FED_UGUNK_DISCHARGE)
Cat_var <- CSC18$PCTPELL_CAT
CSC18 %>% summary()

ada <- plyr::ddply(CSC18, "PCTPELL_CAT", summarise, grp.median=median(BBRR2_FED_UGUNK_DISCHARGE))
Zero_data <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="0") # <= 50%
One_data  <- subset(CSC18, subset = CSC18$PCTPELL_CAT=="1") # >  50%

ggplot(CSC18, aes(x=BBRR2_FED_UGUNK_DISCHARGE,fill=PCTPELL_CAT)) + geom_histogram(color="black",binwidth=.00425) +
  geom_histogram(aes(y=stat(count)/sum(count),fill=PCTPELL_CAT),color="black",binwidth=.00425) +scale_x_continuous(breaks=seq(0,1,.00425)) + scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=c("springgreen","cadetblue2"),labels=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"))+
       facet_grid(PCTPELL_CAT ~ .) + xlab("Percentage of BBRR2_FED_UGUNK_DISCHARGE.(BBRR2_FED_UGUNK_DISCHARGE)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UGUNK_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)") +
       geom_vline(data=ada, aes(xintercept=grp.mean, color=PCTPELL_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count..,label=..count..),binwidth=.00425, geom="text",vjust=-.5)

Quant_var <- CSC18$BBRR2_FED_UGUNK_DISCHARGE

G0 <- Zero_data$BBRR2_FED_UGUNK_DISCHARGE
G1 <- One_data$BBRR2_FED_UGUNK_DISCHARGE

boxplot(Quant_var~Cat_var,
        names=c("0 - Pell Recipients (<=50%)","1 - Pell Recipients (>50%)"), 
        main="Figure 2: Boxplot of BBRR2_FED_UGUNK_DISCHARGE stratified by the categories of PCTPELL_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="PCTPELL_CAT", 
        ylab="BBRR2_FED_UGUNK_DISCHARGE",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
#text(y = round(max(G1),3), 
#     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
#     x =  2.33, 
#     col = "black", 
#     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for STAT_UNK: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")


         # RMD test
Ratio_MD <- RMD.test(G0,G1,direction="two.sided",nsamp=iters,nprt=0)


         # Parametric t-test
ttst <- stats::t.test(G1,G0,
              alternative= "two.sided",
              mu=0, paired = F, 
              var.equal=F,
              conf.level=.95)


         # Wilcoxon Rank-sum
wilcox_test <- stats::wilcox.test(G1,G0,conf.int=T,
                                  alternative="two.sided",conf.level=.95)
wilcox_test

         # Permutation test for the difference in means
perm_Mean <- permTS(G1,G0,
                    method = "exact.mc",
                    alternative = "two.sided",
                    control=permControl(nmc=iters,seed=59911402))
perm_Mean
observed_test_stat_mean <- abs(mean(G1)-mean(G0))
observed_test_stat_mean
diff_mean <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  diff_mean[i] <- abs(mean(shuffles[1:50])-mean(shuffles[51:100]))
}

perm_mean_hist <- hist(diff_mean, 
                       cex.lab=1.5, 
                       cex.axis=1.5,
                       cex.main=1.5)
p_value_mean <- mean(diff_mean >= observed_test_stat_mean)
p_value_mean
plot(perm_mean_hist,col="cadetblue1",xlim=c(0,.0065),main="Histogram for the permutation test on the difference in mean")
abline(v=observed_test_stat_mean,col="blue",lty=1, lwd=5)
text(observed_test_stat_mean - observed_test_stat_mean*.178, 1525*scalr, paste("Observed Test statistic of ",round(observed_test_stat_mean,4),sep=""))
rect(observed_test_stat_mean,0,.0065,1500*scalr,col=alpha("red",0))
text(.0056, 985*scalr, "Difference in mean")
text(.0056, 913*scalr, "greater than or equal")
text(.0056, 848*scalr, "to the observed difference")


         # Permutation test for the difference in medians
observed_test_stat_median <- abs(median(G1)-median(G0))

difmeds <- rep(NA,iters)

for (i in 1:iters){
  all_values <- c(G1,G0)
  shuffles <- sample(all_values,length(all_values),replace=FALSE)
  difmeds[i] <- abs(median(shuffles[1:50])-median(shuffles[51:100]))
}

perm_median_hist <- hist(difmeds,
                         cex.lab=1.5, #changes the size of BOTH word labels for the x and y axes
                         cex.axis=1.5,
                         cex.main=1.5)
p_value <- mean(difmeds >= observed_test_stat_median)
p_value
plot(perm_median_hist,col="cadetblue1",main="Histogram for the permutation test on the difference in median",xlim=c(0,.0035))
abline(v=observed_test_stat_median,col="blue",lty=1, lwd=5)
text(observed_test_stat_median - observed_test_stat_median*.178, 2452*scalr, paste("Observed Test statistic of ",wrapper(observed_test_stat_median),sep=""))
rect(observed_test_stat_median,0,.0035,2400*scalr,col=alpha("red",0))
text(.00315, 1560*scalr, "Difference in medians")
text(.00315, 1440*scalr, "greater than or equal")
text(.00315, 1340*scalr, "to the observed difference")
```

```{r}
CollegeSC18 %<>% mutate("GRAD_CAT" = ifelse(is.na(OMAWDP8_ALL),NA,
                                            ifelse(OMAWDP8_ALL<.25,0,
                                                   ifelse(OMAWDP8_ALL>.75,3,
                                                          ifelse(OMAWDP8_ALL<.5,1,2)))))
CollegeSC18$GRAD_CAT <- as.factor(CollegeSC18$GRAD_CAT)
CollegeSC18 %>% select(GRAD_CAT) %>% summary()

######################################################################################################################################################################
##### VARIABLE: BBRR2_FED_UG_DFLT :: Default rate by Graduation rate Categories ######################################################################################
######################################################################################################################################################################
CSC18 <- CollegeSC18 %>% filter(is.na(GRAD_CAT)==F) %>% filter(is.na(BBRR2_FED_UG_DFLT)==F) %>% select(PCTPELL,PCTPELL_CAT,GRAD_CAT,BBRR2_FED_UG_DFLT)
Cat_var <- CSC18$GRAD_CAT
CSC18 %>% summary()

med <- plyr::ddply(CSC18, "GRAD_CAT", summarise, grp.median=median(BBRR2_FED_UG_DFLT))
Zero_data <- subset(CSC18, subset = CSC18$GRAD_CAT=="0") # <  30%
One_data  <- subset(CSC18, subset = CSC18$GRAD_CAT=="1") # >= 30%
Two_data  <- subset(CSC18, subset = CSC18$GRAD_CAT=="2") # >  65%
Three_data  <- subset(CSC18, subset = CSC18$GRAD_CAT=="3") # >  65%

Quant_var <- CSC18$BBRR2_FED_UG_DFLT

G0 <- Zero_data$BBRR2_FED_UG_DFLT
G1 <- One_data$BBRR2_FED_UG_DFLT
G2 <- Two_data$BBRR2_FED_UG_DFLT
G3 <- Three_data$BBRR2_FED_UG_DFLT

ggplot(CSC18, aes(x=BBRR2_FED_UG_DFLT,fill=GRAD_CAT)) + geom_histogram(binwidth=.034) +
  scale_x_continuous(breaks=seq(0,1,.034)) + #scale_y_continuous(labels=scales::percent) +
  scale_fill_manual(name="group",values=sample(personal_Palette,4),labels=c("< 25%",">= 25% <= 50%","> 50 <= 75","> 75%"))+
       facet_grid(GRAD_CAT ~ .) + xlab("Percentage of BBRR2_FED_UG_DFLT.(BBRR2_FED_UG_DFLT)") +
       labs(title= "Figure 1: Histogram of BBRR2_FED_UG_DFLT stratified by the categories of GRAD_CAT. (n = 5065)") +
       geom_vline(data=med, aes(xintercept=grp.median, color=GRAD_CAT),
                  linetype="dashed",lwd=1.1,show.legend = F) +
       stat_bin(aes(y=..count..,label=..count..),binwidth=.034, geom="text",vjust=-.5)

boxplot(Quant_var~Cat_var,
        names=c("< 25%",">= 25% <= 50%","> 50 <= 75","> 75%"), 
        main="Figure 2: Boxplot of BBRR2_FED_UG_DFLT stratified by the categories of GRAD_CAT. (n = 5065)", 
        boxwex=0.4, 
        xlab="GRAD_CAT", 
        ylab="BBRR2_FED_UG_DFLT",
        cex.lab=1.5,
        cex.main=1,
        cex.axis=1.5,
        col=sample(personal_Palette,2)
        )

# Plot the mean point
points(2,mean(G1),pch=7)
points(1,mean(G0),pch=7)
points(2,mean(G2),pch=7)
points(1,mean(G3),pch=7)

# For the leftside boxplot
text(y = boxplot.stats(G0)$stats, 
     labels = paste(round(boxplot.stats(G0)$stats*100,2),"%",sep=" "), 
     x = 1.34, 
     cex = 1.5)
#text(y = round(min(G0),3), 
#     labels = paste((round(min(G0),3)*100),"%",sep=" "),
#     x = 1.34, 
#     cex = 1.5)
text(y = round(max(G0),3), 
     labels = paste((round(max(G0),3)*100),"%",sep=" "), 
     x =  1.34, 
     col = "black", 
     cex  =1.5)
text(y = round(mean(G0),3), 
     labels = paste((round(mean(G0),3)*100),"%",sep=" "),
     x = 0.67,
     cex = 1.5)

# For the middleLeft boxplot
text(y = boxplot.stats(G1)$stats, 
     labels = paste(round(boxplot.stats(G1)$stats*100,2),"%",sep=" "), 
     x = 2.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G1),3), # leftside 60%
     labels = paste((round(mean(G1),3)*100),"%",sep=" "), 
     x = 1.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G1),3), 
     labels = paste((round(max(G1),3)*100),"%",sep=" "), 
     x =  2.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G1),3), 
#     labels = paste((round(min(G1),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# For the middleRight boxplot
text(y = boxplot.stats(G2)$stats, 
     labels = paste(round(boxplot.stats(G2)$stats*100,2),"%",sep=" "), 
     x = 3.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G2),3), # leftside 60%
     labels = paste((round(mean(G2),3)*100),"%",sep=" "), 
     x = 2.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G2),3), 
     labels = paste((round(max(G2),3)*100),"%",sep=" "), 
     x =  3.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G2),3), 
#     labels = paste((round(min(G2),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# For the rightside boxplot
text(y = boxplot.stats(G3)$stats, 
     labels = paste(round(boxplot.stats(G3)$stats*100,2),"%",sep=" "), 
     x = 4.33, 
     col = "black",
     cex = 1.5)
text(y = round(mean(G3),3), # leftside 60%
     labels = paste((round(mean(G3),3)*100),"%",sep=" "), 
     x = 3.67,
     col = "black",
     cex = 1.5)
text(y = round(max(G3),3), 
     labels = paste((round(max(G3),3)*100),"%",sep=" "), 
     x =  4.33, 
     col = "black", 
     cex  =1.5)
#text(y = round(min(G3),3), 
#     labels = paste((round(min(G3),3)*100),"%",sep=" "),
#     x = 2.33, 
#     col = "black", 
#     cex = 1.5)

# QQ plot
qqnorm(G0,main="Figure 3.A: Q-Q plot for Default rate: G0",pch=19,cex.main=.83)
qqline(G0,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G1,main="Figure 3.B: Q-Q plot for STAT_UNK: G1",pch=19,cex.main=.84)
qqline(G1,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G2,main="Figure 3.B: Q-Q plot for STAT_UNK: G2",pch=19,cex.main=.84)
qqline(G2,col = "steelblue")
abline(v = 0, col="red")

# QQ plot
qqnorm(G3,main="Figure 3.B: Q-Q plot for STAT_UNK: G2",pch=19,cex.main=.84)
qqline(G3,col = "steelblue")
abline(v = 0, col="red")

CollegeSC18 %>% filter(INSTNM == "Harvard University") %>% select(INSTNM,OMAWDP8_ALL)
```

```{r}
med
```






Show in New Window
    PCTPELL       GRAD_CAT BBRR2_FED_UG_DFLT 
 Min.   :0.0000   0: 759   Min.   :0.009326  
 1st Qu.:0.3028   1:1511   1st Qu.:0.056687  
 Median :0.4025   2: 499   Median :0.091584  
 Mean   :0.4362            Mean   :0.097496  
 3rd Qu.:0.5453            3rd Qu.:0.129964  
 Max.   :1.0000            Max.   :0.402985  
























